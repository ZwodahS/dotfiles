alias hclean="cat ~/.bash_history | sed 's/ *$//g' | sort | uniq > ~/.bash_history.clean && mv ~/.bash_history.clean ~/.bash_history"
alias ht="history | tail -n15"
alias htt="history | tail -n30"
alias httt="history | tail -n45"

HISTCONTROL=ignorespace:ignoredups
# export HISTCONTROL=erasedups #:ignorespace
# shopt -s histappend
# http://unix.stackexchange.com/questions/1288/preserve-bash-history-in-multiple-terminal-windows
function history ()
{
    _bash_history_sync
    builtin history "$@"
}
HISTSIZE=100000
function _bash_history_sync()
{
    builtin history -a
    HISTFILESIZE=$HISTSIZE
    builtin history -c
    builtin history -r
}

function _h ()
{
    params=$@
    if [ -z "$params" ]; then
        builtin history
    else
        TMP_HISTORY=~/.bash_history_partial.tmp
        builtin history > $TMP_HISTORY
        for param in $params; do
            cat $TMP_HISTORY | grep "$param" > $TMP_HISTORY.2
            mv $TMP_HISTORY.2 $TMP_HISTORY
        done
        cat $TMP_HISTORY
        \rm $TMP_HISTORY
    fi
}
alias h="_h"

function _hrmindex()
{
    index=$1
    if [ -z "$index" ]; then
        echo "nothing to remove"
    else
        cat ~/.bash_history | sed "$index"d > ~/.bash_history.clean
        mv ~/.bash_history.clean ~/.bash_history
    fi
}

alias hrmi="_hrmindex"

function _hrmgrep()
{
    params=$@
    TMP_HISTORY=~/.bash_history_partial.tmp
    if [ -z "$params" ]; then
        echo "nothing to remove"
    else
        cat ~/.bash_history | grep -v $params > $TMP_HISTORY.2
        mv $TMP_HISTORY.2 ~/.bash_history
    fi
}
